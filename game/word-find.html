<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Find Puzzle - Super Minds</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5deb3 0%, #fffacd 50%, #faebd7 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #logoContainer {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            animation: logoShake 3s ease-in-out infinite;
        }

        #gameLogo {
            width: 120px;
            height: auto;
            border-radius: 15px;
            transition: transform 0.3s;
        }

        #gameLogo:hover {
            transform: scale(1.1);
        }

        @keyframes logoShake {
            0%, 100% { 
                transform: rotate(-5deg) translateY(0px); 
            }
            25% { 
                transform: rotate(5deg) translateY(-5px); 
            }
            50% { 
                transform: rotate(-5deg) translateY(5px); 
            }
            75% { 
                transform: rotate(5deg) translateY(-5px); 
            }
        }

        @media (max-width: 768px) {
            #gameLogo {
                width: 80px;
            }
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1000px;
            width: 100%;
            margin: 10px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        /* Style cho header ch·ª©a logo v√† ti√™u ƒë·ªÅ */
.header-with-logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.header-with-logo img {
    width: 120px;
    height: auto;
    border-radius: 10px;
}

.header-with-logo h1 {
    margin: 0;
    font-size: 2.2em;
}

        .mode-section {
            margin-bottom: 25px;
        }

        .mode-section h2 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 1.4em;
            text-align: center;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 18px 35px;
            font-size: 18px;
            font-weight: bold;
            border: 3px solid #ddd;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            color: #555;
        }

        .mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        .mode-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }

        .mode-btn.practice {
            border-color: #27ae60;
        }

        .mode-btn.practice.selected {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }

        .mode-btn.highscore {
            border-color: #f39c12;
        }

        .mode-btn.highscore.selected {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .mode-info {
            background: #f0f4ff;
            padding: 12px;
            border-radius: 10px;
            margin: 12px 0;
            font-size: 13px;
            color: #555;
            text-align: center;
        }

        .setup-section {
            display: none;
            margin-bottom: 25px;
        }

        .setup-section h2 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 1.4em;
            text-align: center;
        }

        .selection-row {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .select-group {
            flex: 1;
            min-width: 200px;
        }

        .select-group label {
            display: block;
            margin-bottom: 6px;
            color: #555;
            font-weight: bold;
            font-size: 14px;
        }

        select {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            border: 3px solid #667eea;
            border-radius: 8px;
            background: white;
            cursor: pointer;
        }

        .btn {
            padding: 12px 25px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-container {
            text-align: center;
            margin-top: 15px;
        }

        .game-section {
            display: none;
        }

        /* G·ªôp c√°c th√†nh ph·∫ßn game header v√†o c√πng m·ªôt h√†ng */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .game-info {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .info-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 13px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            white-space: nowrap;
        }

        .score-display {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .combo-display {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* S·∫Øp x·∫øp progress v√† current word v√†o c√πng h√†ng */
        .progress-and-word-section {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-section {
            grid-column: 1;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-weight: bold;
            color: #555;
            font-size: 13px;
        }

        .progress-bar-container {
            width: 100%;
            height: 16px;
            background: #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #27ae60 0%, #2ecc71 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 11px;
        }

        .current-word-section {
            grid-column: 2;
            text-align: center;
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-width: 180px;
        }

        .word-label {
            font-size: 13px;
            color: #555;
            margin-bottom: 3px;
        }

        .word-letters {
            font-size: 22px;
            font-weight: bold;
            color: #2c3e50;
            letter-spacing: 2px;
            font-family: monospace;
            min-height: 30px;
            line-height: 30px;
        }

        /* Hint display ph√≠a tr√™n grid */
        .hint-section {
            margin: 5px 0 10px 0;
            text-align: center;
        }

        .hint-display {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            animation: hintSlideDown 0.5s ease;
            display: none;
        }

        .hint-display.wrong {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .hint-display.hint {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        @keyframes hintSlideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Thu nh·ªè grid ƒë·ªÉ hi·ªÉn th·ªã g·ªçn h∆°n */
        .grid-container {
            margin: 15px 0;
            display: flex;
            justify-content: center;
        }

        .grid-board {
            display: grid;
            grid-template-columns: repeat(10, 40px);
            grid-template-rows: repeat(10, 40px);
            gap: 2px;
            background: #34495e;
            padding: 4px;
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .grid-cell {
            width: 40px;
            height: 40px;
            background: #ecf0f1;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .grid-cell:hover {
            background: #d5dbdb;
            transform: scale(1.1);
        }

        .grid-cell.has-letter {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            animation: fadeIn 0.3s ease;
        }

        .grid-cell.selected {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            border-color: #d35400;
            transform: scale(1.15);
        }

        .grid-cell.correct {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            animation: correctAnim 0.5s ease;
        }

        .grid-cell.hint {
            border: 3px solid gold !important;
            box-shadow: 0 0 20px gold !important;
            animation: hintPulse 1.5s infinite;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.5);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes correctAnim {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3) rotate(10deg); }
        }

        @keyframes hintPulse {
            0%, 100% { 
                box-shadow: 0 0 20px gold;
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 35px gold, 0 0 45px gold;
                transform: scale(1.05);
            }
        }

        .feedback {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            margin: 8px 0;
            min-height: 30px;
            animation: fadeIn 0.3s ease;
            padding: 6px;
            border-radius: 6px;
        }

        .feedback.correct {
            color: #27ae60;
            background: #d5f4e6;
        }

        .feedback.wrong {
            color: #e74c3c;
            background: #fadbd8;
        }

        .feedback.hint {
            color: #f39c12;
            background: #fef5e7;
        }

        .feedback.game-over {
            color: #d63031;
            background: #ffeaa7;
            font-size: 18px;
            padding: 12px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 550px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content h2 {
            font-size: 32px;
            margin-bottom: 15px;
            color: #667eea;
        }

        .modal-stats {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .modal-stats div {
            margin: 8px 0;
            font-size: 16px;
            color: #555;
        }

        .word-list {
            max-height: 180px;
            overflow-y: auto;
            margin: 12px 0;
            padding: 12px;
            background: #f0f4ff;
            border-radius: 8px;
            text-align: left;
        }

        .word-list h3 {
            color: #764ba2;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .word-list-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .word-item {
            padding: 4px 8px;
            background: white;
            border-radius: 4px;
            font-weight: bold;
            font-size: 13px;
            border: 2px solid #ddd;
        }

        .word-item.completed {
            border-color: #27ae60;
            color: #27ae60;
        }

        .word-item.incomplete {
            border-color: #e74c3c;
            color: #e74c3c;
        }

        .word-item.bonus {
            border-color: #f39c12;
            color: #f39c12;
            background: #fff9e6;
        }

        .bonus-words-section {
            margin: 12px 0;
            padding: 12px;
            background: #fff9e6;
            border-radius: 8px;
            border: 2px solid #f39c12;
        }

        .bonus-words-section h3 {
            color: #f39c12;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .leaderboard {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .leaderboard h3 {
            color: #764ba2;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            margin: 4px 0;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            font-size: 14px;
        }

        .leaderboard-entry.top1 {
            border-left-color: #f39c12;
            background: #fff9e6;
        }

        .leaderboard-entry.top2 {
            border-left-color: #95a5a6;
        }

        .leaderboard-entry.top3 {
            border-left-color: #cd7f32;
        }

        .music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .music-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .music-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .music-btn.muted {
            background: #95a5a6;
        }

        /* C√°c n√∫t control ·ªü g√≥c tr√°i d∆∞·ªõi */
        .control-buttons-left {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            display: none;
        }

        /* N√∫t check l·ªõn */
        .check-btn-large {
            position: fixed;
            bottom: 80px;
            left: 20px;
            z-index: 100;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
            cursor: pointer;
            font-size: 22px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            display: none;
        }

        .check-btn-large:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        .check-btn-large:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Style cho c√°c n√∫t control nh·ªè */
        .control-btn-small {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .control-btn-small:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        .control-btn-small:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .pause-btn-small {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .reset-btn-small {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        }

        .hint-btn-small {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .pause-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        .pause-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 450px;
            width: 90%;
        }

        .pause-content h2 {
            color: #3498db;
            font-size: 40px;
            margin-bottom: 15px;
        }

        .vocab-status {
            background: #e8f5e9;
            border: 2px solid #27ae60;
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            color: #27ae60;
            font-weight: bold;
            text-align: center;
            font-size: 14px;
        }

        .vocab-status.error {
            background: #ffebee;
            border-color: #e74c3c;
            color: #e74c3c;
        }

        /* Responsive cho c√°c k√≠ch th∆∞·ªõc m√†n h√¨nh */
        @media (max-width: 1100px) {
            .grid-board {
                grid-template-columns: repeat(10, 36px);
                grid-template-rows: repeat(10, 36px);
            }
            
            .grid-cell {
                width: 36px;
                height: 36px;
                font-size: 18px;
            }
            
            .current-word-section {
                min-width: 160px;
            }
            
            .word-letters {
                font-size: 20px;
            }
        }

        @media (max-width: 900px) {
            .progress-and-word-section {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .current-word-section {
                grid-column: 1;
            }
            
            .grid-board {
                grid-template-columns: repeat(10, 34px);
                grid-template-rows: repeat(10, 34px);
            }
            
            .grid-cell {
                width: 34px;
                height: 34px;
                font-size: 17px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .mode-btn {
                padding: 15px 25px;
                font-size: 16px;
            }
            
            .game-header {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            
            .game-info {
                justify-content: center;
            }
            
            .grid-board {
                grid-template-columns: repeat(8, 35px);
                grid-template-rows: repeat(8, 35px);
            }
            
            .grid-cell {
                width: 35px;
                height: 35px;
                font-size: 18px;
            }
            
            .music-btn {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .control-btn-small {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
            
            .check-btn-large {
                width: 55px;
                height: 55px;
                font-size: 20px;
                bottom: 75px;
            }
            
            .hint-display {
                font-size: 14px;
                padding: 6px 12px;
            }
            
            .progress-and-word-section {
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.6em;
            }
            
            .mode-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .mode-btn {
                width: 100%;
                max-width: 250px;
            }
            
            .selection-row {
                flex-direction: column;
            }
            
            .select-group {
                min-width: 100%;
            }
            
            .game-info {
                gap: 6px;
            }
            
            .info-box {
                padding: 5px 10px;
                font-size: 12px;
            }
            
            .grid-board {
                grid-template-columns: repeat(8, 30px);
                grid-template-rows: repeat(8, 30px);
            }
            
            .grid-cell {
                width: 30px;
                height: 30px;
                font-size: 16px;
            }
            
            .current-word-section {
                padding: 6px 12px;
                min-width: auto;
            }
            
            .word-letters {
                font-size: 18px;
                letter-spacing: 1px;
            }
            
            .check-btn-large {
                width: 50px;
                height: 50px;
                font-size: 18px;
                bottom: 70px;
                left: 15px;
            }
            
            .control-buttons-left {
                left: 15px;
                bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="logoContainer">
        <img src="logo.png" alt="Super Minds Logo" id="gameLogo">
    </div>

    <div class="music-control">
        <button id="musicToggle" class="music-btn" onclick="toggleMusic()">‚ô´</button>
    </div>

    <!-- N√∫t check l·ªõn -->
    <button id="checkBtnLarge" class="check-btn-large" onclick="checkWord()" title="Check Word">‚úì</button>

    <!-- C√°c n√∫t control ·ªü g√≥c tr√°i d∆∞·ªõi -->
    <div class="control-buttons-left">
        <button id="pauseBtnSmall" class="control-btn-small pause-btn-small" onclick="togglePause()" title="Pause">‚è∏Ô∏è</button>
        <button id="resetBtnSmall" class="control-btn-small reset-btn-small" onclick="useReset()" title="Reset Grid">üîÑ</button>
        <button id="hintBtnSmall" class="control-btn-small hint-btn-small" onclick="useHint()" title="Hint">üí°</button>
    </div>

    <div class="container">
        <div id="modeSection" class="mode-section">
        <div class="header-with-logo">
                <img src="word-find.png" alt="Word Find Logo">
                <h1 id="mainTitle"> Word Find Puzzle </h1>
            </div>
            <div id="vocabStatus" class="vocab-status" style="display: none;"></div>
            <h2>üìö Ch·ªçn Ch·∫ø ƒê·ªô Ch∆°i</h2>
            <div class="mode-selector">
                <button class="mode-btn practice selected" onclick="selectMode('practice')">
                    üìù Tr·∫£ B√†i
                </button>
                <button class="mode-btn highscore" onclick="selectMode('highscore')">
                    üèÜ Thi ƒêua ƒêi·ªÉm Cao
                </button>
            </div>
            <div id="modeInfo" class="mode-info">
                <strong>TR·∫¢ B√ÄI:</strong> Ho√†n th√†nh t·∫•t c·∫£ t·ª´ v·ª±ng trong Level v√† Unit ƒë√£ ch·ªçn üìñ
            </div>
        </div>

        <div id="setupSection" class="setup-section">
            <h2>‚öôÔ∏è C√†i ƒê·∫∑t Game</h2>
            
            <div class="selection-row">
                <div class="select-group">
                    <label for="levelSelect">üìö Ch·ªçn Level:</label>
                    <select id="levelSelect" onchange="onLevelChange()">
                        <option value="">-- Ch·ªçn Level --</option>
                        <option value="0">Super Minds 0</option>
                        <option value="1">Super Minds 1</option>
                        <option value="2">Super Minds 2</option>
                        <option value="3">Super Minds 3</option>
                        <option value="4">Super Minds 4</option>
                        <option value="5">Super Minds 5</option>
                        <option value="6">Super Minds 6</option>
                    </select>
                </div>
                <div class="select-group">
                    <label for="unitSelect">üìñ Ch·ªçn Unit:</label>
                    <select id="unitSelect" disabled onchange="onUnitChange()">
                        <option value="">-- Ch·ªçn Unit --</option>
                    </select>
                </div>
            </div>
            <div class="btn-container">
                <button id="startBtn" class="btn btn-success" onclick="startGame()" disabled>
                    üéÆ B·∫Øt ƒê·∫ßu Ch∆°i
                </button>
            </div>
        </div>

<div id="gameSection" class="game-section">
    <!-- Thanh ti·∫øn ƒë·ªô l√™n tr√™n -->
    <div class="progress-section">
        <div class="progress-label">
            <span>üìä Ti·∫øn ƒê·ªô</span>
            <span id="progressText">0 / 0</span>
        </div>
        <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar" style="width: 0%;">0%</div>
        </div>
    </div>

    <!-- S·ª≠ d·ª•ng l·∫°i class progress-and-word-section nh∆∞ng ƒë·ªïi n·ªôi dung -->
    <div class="progress-and-word-section">
        <div class="game-info" style="grid-column: 1;">
            <div class="info-box score-display">
                üí∞ <span id="score">0</span>
            </div>
            <div id="comboDisplay" class="info-box combo-display" style="display: none;">
                üî• x<span id="combo">1</span>
            </div>
            <div class="info-box">
                ‚è±Ô∏è <span id="speedLevel">1</span>
            </div>
            <div class="info-box" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                üìö <span id="bonusCount">0</span>
            </div>
        </div>
        
        <div class="current-word-section" style="grid-column: 2;">
            <div class="word-label">T·ª´ b·∫°n ƒëang gh√©p:</div>
            <div id="currentWord" class="word-letters">___</div>
        </div>
    </div>

    <!-- Ph·∫ßn c√≤n l·∫°i gi·ªØ nguy√™n -->
    <div class="hint-section">
        <div id="hintDisplay" class="hint-display"></div>
    </div>

    <div class="grid-container">
        <div id="gridBoard" class="grid-board"></div>
    </div>

    <div id="feedback" class="feedback"></div>
</div>

        <div id="gameOverModal" class="modal">
            <div class="modal-content">
                <h2 id="modalTitle">üéâ K·∫øt Qu·∫£ üéâ</h2>
                <div class="modal-stats">
                    <div id="finalScore"><strong>T·ªïng ƒêi·ªÉm:</strong> 0</div>
                    <div id="modeDisplay"></div>
                    <div id="completionStats"></div>
                </div>
                <div id="bonusWordsSection" class="bonus-words-section" style="display: none;">
                    <h3>‚≠ê T·ª´ M·ªü R·ªông ƒê√£ T√¨m ƒê∆∞·ª£c</h3>
                    <div class="word-list-items" id="bonusWordsList"></div>
                </div>
                <div id="wordListSection" class="word-list" style="display: none;">
                    <h3>Danh S√°ch T·ª´ V·ª±ng B√†i H·ªçc</h3>
                    <div class="word-list-items" id="wordListItems"></div>
                </div>
                <div id="leaderboardSection" class="leaderboard" style="display: none;">
                    <h3>üèÜ B·∫£ng X·∫øp H·∫°ng Top 5</h3>
                    <div id="leaderboardList"></div>
                </div>
                <div class="btn-container">
                    <button class="btn btn-primary" onclick="playAgain()">üîÑ Ch∆°i L·∫°i</button>
                </div>
            </div>
        </div>

        <div id="pauseOverlay" class="pause-overlay">
            <div class="pause-content">
                <h2>‚è∏Ô∏è PAUSED</h2>
                
                <div id="practiceWordList" style="display: none; margin: 15px 0;">
                    <h3 style="color: #667eea; margin-bottom: 12px; font-size: 16px;">üìö C√°c t·ª´ c·∫ßn t√¨m trong b√†i:</h3>
                    <div class="word-list-items" id="pauseWordList" style="max-height: 180px; overflow-y: auto; padding: 10px; background: #f0f4ff; border-radius: 8px;"></div>
                </div>
                
                <div id="highscoreMessage" style="display: none; margin: 15px 0; padding: 12px; background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%); border-radius: 8px;">
                    <p style="font-size: 16px; color: #d63031; font-weight: bold;">üí™ B·∫°n l√†m ƒë∆∞·ª£c m√†! Ti·∫øp t·ª•c chi·∫øn ƒë·∫•u n√†o! üöÄ</p>
                    <p style="margin-top: 8px; color: #e17055; font-size: 14px;">üî• Combo hi·ªán t·∫°i: <span id="pauseCombo">0</span></p>
                </div>
                
                <button class="btn btn-primary" onclick="togglePause()">‚ñ∂Ô∏è Resume</button>
            </div>
        </div>
    </div>

    <script>
        const backgroundMusic = new Audio('background-music.mp3');
        backgroundMusic.loop = true;
        backgroundMusic.volume = 0.5;

        const correctSound = new Audio('right.mp3');
        const wrongSound = new Audio('drop.mp3');
        const comboSound = new Audio('drop.mp3');

        let isMusicPlaying = false;
        let musicInitialized = false;

        let vocabData = {};
        let expansionVocab = [];
        let allVocabWords = [];
        let vocabLoaded = false;

        function loadVocabFile(fileContent) {
            vocabData = {};
            expansionVocab = [];
            const lines = fileContent.split('\n');
            let currentLevel = null;
            let currentUnit = null;
            let isExpansion = false;

            lines.forEach(line => {
                line = line.trim();
                if (!line) return;

                if (line.match(/===\s*Expansion\s*===/i)) {
                    isExpansion = true;
                    currentLevel = null;
                    currentUnit = null;
                    return;
                }

                const levelMatch = line.match(/===\s*Super Minds\s+(\d+)\s*===/);
                if (levelMatch) {
                    isExpansion = false;
                    currentLevel = levelMatch[1];
                    vocabData[currentLevel] = {};
                    return;
                }

                const unitMatch = line.match(/\[Unit\s+(\d+)\]/);
                if (unitMatch) {
                    currentUnit = unitMatch[1];
                    if (currentLevel !== null && !isExpansion) {
                        vocabData[currentLevel][currentUnit] = [];
                    }
                    return;
                }

                if (isExpansion && line.length > 0) {
                    expansionVocab.push(line.toLowerCase());
                } else if (currentLevel !== null && currentUnit !== null && line.length > 0) {
                    vocabData[currentLevel][currentUnit].push(line.toLowerCase());
                }
            });

            buildAllVocabList();
            populateLevelSelect();
            vocabLoaded = true;
            showVocabStatus(true);
            console.log('Vocabulary loaded:', vocabData);
            console.log('Expansion vocab:', expansionVocab);
        }

        function buildAllVocabList() {
            allVocabWords = [];
            Object.values(vocabData).forEach(level => {
                Object.values(level).forEach(unitWords => {
                    allVocabWords.push(...unitWords);
                });
            });
            allVocabWords.push(...expansionVocab);
        }

        function populateLevelSelect() {
            const levelSelect = document.getElementById('levelSelect');
            levelSelect.innerHTML = '<option value="">-- Ch·ªçn Level --</option>';
            
            Object.keys(vocabData).sort((a, b) => parseInt(a) - parseInt(b)).forEach(level => {
                const option = document.createElement('option');
                option.value = level;
                option.textContent = `Super Minds ${level}`;
                levelSelect.appendChild(option);
            });
        }

        function showVocabStatus(success) {
            const statusEl = document.getElementById('vocabStatus');
            statusEl.style.display = 'block';
            
            if (success) {
                statusEl.className = 'vocab-status';
                const totalWords = allVocabWords.length;
                const levels = Object.keys(vocabData).length;
                statusEl.textContent = `‚úÖ ƒê√£ t·∫£i ${totalWords} t·ª´ v·ª±ng t·ª´ ${levels} levels + ${expansionVocab.length} t·ª´ m·ªü r·ªông`;
            } else {
                statusEl.className = 'vocab-status error';
                statusEl.textContent = '‚ùå Kh√¥ng t√¨m th·∫•y file vocab.txt! H√£y ƒë·∫∑t file vocab.txt c√πng th∆∞ m·ª•c v·ªõi file HTML n√†y.';
            }
        }

        window.onload = function() {
            fetch('vocab.txt')
                .then(response => {
                    if (!response.ok) throw new Error('File not found');
                    return response.text();
                })
                .then(text => {
                    loadVocabFile(text);
                    console.log('Vocabulary file loaded successfully!');
                })
                .catch(err => {
                    console.error('Failed to load vocab.txt:', err);
                    showVocabStatus(false);
                    vocabLoaded = false;
                });
            
            document.getElementById('modeSection').style.display = 'block';
        };

        let gameMode = 'practice';
        let selectedLevel = '';
        let selectedUnit = '';
        let targetWords = [];
        let completedWords = [];
        let bonusWords = [];
        let currentScore = 0;
        let currentCombo = 0;
        let speedLevel = 1;
        let hintsRemaining = 5;
        let resetsRemaining = 3;
        let isPaused = false;
        let isGameOver = false;

        const gridSize = 10;
        let gridCells = [];
        let selectedCells = [];
        let letterSpawnInterval = null;
        let spawnDelay = 5000;
        let currentWordForSpawn = null;
        let lettersToSpawn = [];

        function initializeGrid() {
            const gridBoard = document.getElementById('gridBoard');
            gridBoard.innerHTML = '';
            gridCells = [];
            
            const isMobile = window.innerWidth <= 768;
            const actualSize = isMobile ? 8 : gridSize;
            const cellSize = isMobile ? 35 : 40;
            gridBoard.style.gridTemplateColumns = `repeat(${actualSize}, ${cellSize}px)`;
            gridBoard.style.gridTemplateRows = `repeat(${actualSize}, ${cellSize}px)`;
            
            for (let i = 0; i < actualSize * actualSize; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                cell.dataset.index = i;
                cell.onclick = () => selectCell(i);
                gridBoard.appendChild(cell);
                gridCells.push({
                    element: cell,
                    letter: '',
                    hasLetter: false
                });
            }
        }

        function spawnSpecificWord(word) {
            const letters = word.split('').map(l => l.toUpperCase());
            const emptyCells = gridCells
                .map((cell, index) => ({ cell, index }))
                .filter(({ cell }) => !cell.hasLetter);
            
            if (emptyCells.length === 0) {
                console.log('Kh√¥ng c√≤n √¥ tr·ªëng cho t·ª´:', word);
                checkGridFull();
                return false;
            }
            
            if (emptyCells.length < letters.length) {
                console.log('Kh√¥ng ƒë·ªß √¥ tr·ªëng cho t·ª´ ƒë·∫ßy ƒë·ªß:', word);
                
                const cellsToUse = emptyCells.sort(() => Math.random() - 0.5);
                
                cellsToUse.forEach(({ cell, index }, i) => {
                    if (i < letters.length) {
                        cell.letter = letters[i];
                        cell.hasLetter = true;
                        cell.element.textContent = letters[i];
                        cell.element.classList.add('has-letter');
                    }
                });
                
                console.log('ƒê√£ spawn', Math.min(cellsToUse.length, letters.length), 'ch·ªØ c·ªßa t·ª´', word);
                checkGridFull();
                return cellsToUse.length > 0;
            }
            
            const shuffledEmptyCells = [...emptyCells].sort(() => Math.random() - 0.5);
            const selectedCells = shuffledEmptyCells.slice(0, letters.length);
            
            selectedCells.forEach(({ cell, index }, i) => {
                cell.letter = letters[i];
                cell.hasLetter = true;
                cell.element.textContent = letters[i];
                cell.element.classList.add('has-letter');
            });
            
            console.log('Spawn t·ª´:', word, 'v√†o', selectedCells.length, '√¥ ng·∫´u nhi√™n');
            checkGridFull();
            return true;
        }

        function checkGridFull() {
            const emptyCells = gridCells.filter(cell => !cell.hasLetter);
            if (emptyCells.length === 0 && !isGameOver) {
                endGameDueToFullGrid();
            }
        }

        function endGameDueToFullGrid() {
            isGameOver = true;
            clearInterval(letterSpawnInterval);
            
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.className = 'feedback game-over';
            feedbackEl.textContent = '‚ùå GAME OVER! Grid ƒë√£ ƒë·∫ßy, kh√¥ng c√≤n ch·ªó cho ch·ªØ m·ªõi!';
            
            setTimeout(() => {
                endGame(false, true);
            }, 2000);
        }

        function smartSpawn(isFullWord = false) {
            if (isGameOver || isPaused) return;
            
            const uncompletedWords = targetWords.filter(word => 
                !completedWords.includes(word) && 
                !bonusWords.includes(word)
            );
            
            if (uncompletedWords.length === 0) {
                const availableExpansionWords = expansionVocab.filter(word => 
                    !bonusWords.includes(word) && 
                    !completedWords.includes(word)
                );
                
                if (availableExpansionWords.length > 0) {
                    const word = availableExpansionWords[Math.floor(Math.random() * availableExpansionWords.length)];
                    const spawned = spawnSpecificWord(word);
                    if (!spawned) return;
                }
                return;
            }
            
            const gridLetters = gridCells
                .filter(cell => cell.hasLetter)
                .map(cell => cell.letter.toLowerCase());
            
            const completableWords = uncompletedWords.filter(word => {
                const wordLetters = word.split('');
                return wordLetters.every(letter => 
                    gridLetters.includes(letter)
                );
            });
            
            const incompleteWords = uncompletedWords.filter(word => {
                const wordLetters = word.split('');
                const missingLetters = wordLetters.filter(letter => 
                    !gridLetters.includes(letter)
                );
                return missingLetters.length > 0;
            });
            
            let selectedWord;
            
            if (isFullWord) {
                if (incompleteWords.length > 0) {
                    selectedWord = incompleteWords[Math.floor(Math.random() * incompleteWords.length)];
                } else if (completableWords.length > 0) {
                    selectedWord = completableWords[Math.floor(Math.random() * completableWords.length)];
                } else {
                    selectedWord = uncompletedWords[Math.floor(Math.random() * uncompletedWords.length)];
                }
                
                const spawned = spawnSpecificWord(selectedWord);
                if (!spawned) return;
            } else {
                if (incompleteWords.length > 0) {
                    selectedWord = incompleteWords[Math.floor(Math.random() * incompleteWords.length)];
                } else {
                    selectedWord = uncompletedWords[Math.floor(Math.random() * uncompletedWords.length)];
                }
                
                spawnSingleLetterForWord(selectedWord);
            }
            
            console.log('Smart spawn:', isFullWord ? 'full word' : 'single letter', '- Selected:', selectedWord);
        }

        function spawnSingleLetterForWord(word) {
            const wordLetters = word.toUpperCase().split('');
            const gridLetters = gridCells
                .filter(cell => cell.hasLetter)
                .map(cell => cell.letter);
            
            const missingLetters = wordLetters.filter(letter => 
                !gridLetters.includes(letter)
            );
            
            let letterToSpawn;
            
            if (missingLetters.length === 0) {
                letterToSpawn = wordLetters[Math.floor(Math.random() * wordLetters.length)];
            } else {
                letterToSpawn = missingLetters[Math.floor(Math.random() * missingLetters.length)];
            }
            
            const emptyCells = gridCells
                .map((cell, index) => ({ cell, index }))
                .filter(({ cell }) => !cell.hasLetter);
            
            if (emptyCells.length === 0) {
                console.log('Kh√¥ng c√≤n √¥ tr·ªëng ƒë·ªÉ spawn ch·ªØ:', letterToSpawn);
                checkGridFull();
                return false;
            }
            
            const randomIndex = Math.floor(Math.random() * emptyCells.length);
            const { cell, index } = emptyCells[randomIndex];
            
            cell.letter = letterToSpawn;
            cell.hasLetter = true;
            cell.element.textContent = letterToSpawn;
            cell.element.classList.add('has-letter');
            
            console.log('Spawn ch·ªØ', letterToSpawn, 'cho t·ª´', word, 't·∫°i √¥', index);
            checkGridFull();
            return true;
        }

        function spawnLetter() {
            if (isGameOver || isPaused) return;
            smartSpawn(false);
        }

        function useReset() {
            if (resetsRemaining <= 0 || isPaused || isGameOver) return;
            
            if (confirm(`B·∫°n c√≥ mu·ªën reset grid? S·∫Ω c√≤n ${resetsRemaining - 1} l∆∞·ª£t reset sau l·∫ßn n√†y.`)) {
                resetsRemaining--;
                document.getElementById('resetBtnSmall').innerHTML = `üîÑ<br><small>${resetsRemaining}</small>`;
                
                gridCells.forEach(cell => {
                    if (cell.hasLetter) {
                        cell.element.classList.remove('has-letter', 'selected', 'correct', 'hint');
                        cell.element.textContent = '';
                        cell.hasLetter = false;
                        cell.letter = '';
                    }
                });
                
                selectedCells = [];
                updateCurrentWord();
                
                clearAllHints();
                
                const uncompletedWords = targetWords.filter(word => !completedWords.includes(word));
                if (uncompletedWords.length > 0) {
                    const wordsToSpawn = uncompletedWords
                        .sort(() => Math.random() - 0.5)
                        .slice(0, Math.min(3, uncompletedWords.length));
                    
                    wordsToSpawn.forEach(word => {
                        spawnSpecificWord(word);
                    });
                    
                    const feedbackEl = document.getElementById('feedback');
                    feedbackEl.className = 'feedback hint';
                    feedbackEl.textContent = `üîÑ ƒê√£ reset grid! Spawn ${wordsToSpawn.length} t·ª´ m·ªõi.`;
                    setTimeout(() => {
                        feedbackEl.textContent = '';
                        feedbackEl.className = 'feedback';
                    }, 3000);
                }
            }
        }

        function selectMode(mode) {
            if (!vocabLoaded) {
                alert('‚ö†Ô∏è Ch∆∞a t·∫£i ƒë∆∞·ª£c file vocab.txt! H√£y ƒë·∫£m b·∫£o file vocab.txt n·∫±m c√πng th∆∞ m·ª•c v·ªõi file HTML.');
                return;
            }
            
            gameMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('selected'));
            
            if (mode === 'practice') {
                document.querySelector('.mode-btn.practice').classList.add('selected');
                document.getElementById('modeInfo').innerHTML = '<strong>TR·∫¢ B√ÄI:</strong> Ho√†n th√†nh t·∫•t c·∫£ t·ª´ v·ª±ng trong Level v√† Unit ƒë√£ ch·ªçn üìñ';
            } else {
                document.querySelector('.mode-btn.highscore').classList.add('selected');
                document.getElementById('modeInfo').innerHTML = '<strong>THI ƒêUA ƒêI·ªÇM CAO:</strong> Ho√†n th√†nh t·ª´ v·ª±ng t·ª´ Level th·∫•p ƒë·∫øn Level b·∫°n ƒë√£ h·ªçc üèÜ';
            }
            
            document.getElementById('setupSection').style.display = 'block';
        }

        function onLevelChange() {
            const levelSelect = document.getElementById('levelSelect');
            const unitSelect = document.getElementById('unitSelect');
            selectedLevel = levelSelect.value;
            
            if (selectedLevel) {
                unitSelect.disabled = false;
                unitSelect.innerHTML = '<option value="">-- Ch·ªçn Unit --</option>';
                
                if (vocabData[selectedLevel]) {
                    Object.keys(vocabData[selectedLevel]).forEach(unit => {
                        const option = document.createElement('option');
                        option.value = unit;
                        option.textContent = `Unit ${unit}`;
                        unitSelect.appendChild(option);
                    });
                }
            } else {
                unitSelect.disabled = true;
                unitSelect.innerHTML = '<option value="">-- Ch·ªçn Unit --</option>';
                document.getElementById('startBtn').disabled = true;
            }
        }

        function onUnitChange() {
            selectedUnit = document.getElementById('unitSelect').value;
            document.getElementById('startBtn').disabled = !selectedUnit;
        }

        function startGame() {
            if (!vocabLoaded) {
                alert('‚ö†Ô∏è Ch∆∞a t·∫£i ƒë∆∞·ª£c file vocab.txt!');
                return;
            }
            
            initializeMusic();
            
            targetWords = [];
            
            if (gameMode === 'practice') {
                if (vocabData[selectedLevel] && vocabData[selectedLevel][selectedUnit]) {
                    targetWords = [...vocabData[selectedLevel][selectedUnit]];
                }
            } else {
                for (let level = 0; level <= parseInt(selectedLevel); level++) {
                    if (vocabData[level.toString()]) {
                        Object.values(vocabData[level.toString()]).forEach(unitWords => {
                            targetWords.push(...unitWords);
                        });
                    }
                }
            }
            
            if (targetWords.length === 0) {
                alert('Kh√¥ng c√≥ t·ª´ v·ª±ng n√†o trong Level/Unit n√†y!');
                return;
            }
            
            targetWords.sort(() => Math.random() - 0.5);
            
            completedWords = [];
            bonusWords = [];
            currentScore = 0;
            currentCombo = 0;
            speedLevel = 1;
            hintsRemaining = 5;
            resetsRemaining = 3;
            isPaused = false;
            isGameOver = false;
            selectedCells = [];
            currentWordForSpawn = null;
            lettersToSpawn = [];
            spawnDelay = 8000;
            
            document.getElementById('score').textContent = currentScore;
            document.getElementById('combo').textContent = currentCombo;
            document.getElementById('speedLevel').textContent = speedLevel;
            document.getElementById('bonusCount').textContent = '0';
            document.getElementById('comboDisplay').style.display = 'none';
            document.getElementById('progressText').textContent = `0 / ${targetWords.length}`;
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressBar').textContent = '0%';
            document.getElementById('currentWord').textContent = '___';
            document.getElementById('feedback').textContent = '';
            
            document.getElementById('hintBtnSmall').innerHTML = `üí°<br><small>${hintsRemaining}</small>`;
            document.getElementById('resetBtnSmall').innerHTML = `üîÑ<br><small>${resetsRemaining}</small>`;
            
            clearAllHints();
            
            document.getElementById('mainTitle').style.display = 'none';
            document.getElementById('modeSection').style.display = 'none';
            document.getElementById('setupSection').style.display = 'none';
            document.getElementById('gameSection').style.display = 'block';
            document.querySelector('.control-buttons-left').style.display = 'flex';
            document.getElementById('checkBtnLarge').style.display = 'flex';
            
            initializeGrid();
            
            setTimeout(() => {
                smartSpawn(true);
                
                const spawnAdditionalWords = () => {
                    if (!isGameOver) {
                        smartSpawn(true);
                    }
                };
                
                setTimeout(spawnAdditionalWords, 300);
                setTimeout(spawnAdditionalWords, 600);
                setTimeout(spawnAdditionalWords, 900);
            }, 300);
            
            startLetterSpawning();
            
            if (gameMode === 'practice') {
                setTimeout(() => {
                    togglePause();
                }, 1500);
            }
        }

        function startLetterSpawning() {
            if (letterSpawnInterval) {
                clearInterval(letterSpawnInterval);
            }
            letterSpawnInterval = setInterval(() => {
                if (!isPaused && !isGameOver) {
                    spawnLetter();
                }
            }, spawnDelay);
        }

        function selectCell(index) {
            if (isPaused || isGameOver) return;
            
            const cell = gridCells[index];
            if (!cell.hasLetter) return;
            
            if (cell.element.classList.contains('hint')) {
                cell.element.classList.remove('hint');
            }
            
            const selectedIndex = selectedCells.indexOf(index);
            if (selectedIndex !== -1) {
                selectedCells.splice(selectedIndex, 1);
                cell.element.classList.remove('selected');
            } else {
                selectedCells.push(index);
                cell.element.classList.add('selected');
            }
            
            updateCurrentWord();
        }

        function updateCurrentWord() {
            const word = selectedCells.map(i => gridCells[i].letter).join('');
            document.getElementById('currentWord').textContent = word || '___';
            document.getElementById('checkBtnLarge').disabled = word.length === 0;
        }

        function useHint() {
            if (hintsRemaining <= 0) {
                showHintMessage('‚ùå B·∫°n ƒë√£ h·∫øt l∆∞·ª£t g·ª£i √Ω!', 'wrong');
                return;
            }
            
            if (isPaused || isGameOver) {
                showHintMessage('‚ùå Tr√≤ ch∆°i ƒëang t·∫°m d·ª´ng/k·∫øt th√∫c!', 'wrong');
                return;
            }
            
            clearAllHints();
            
            const gridLetters = gridCells
                .filter(cell => cell.hasLetter)
                .map(cell => cell.letter.toLowerCase());
            
            const availableWords = [];
            
            targetWords.forEach(word => {
                if (!completedWords.includes(word) && canFormWord(word, gridLetters)) {
                    availableWords.push({
                        word: word,
                        type: 'main',
                        cells: findWordCells(word)
                    });
                }
            });
            
            expansionVocab.forEach(word => {
                if (!bonusWords.includes(word) && canFormWord(word, gridLetters)) {
                    availableWords.push({
                        word: word,
                        type: 'bonus',
                        cells: findWordCells(word)
                    });
                }
            });
            
            if (availableWords.length === 0) {
                showHintMessage('üí° Kh√¥ng t√¨m th·∫•y t·ª´ n√†o c√≥ th·ªÉ gh√©p t·ª´ c√°c ch·ªØ hi·ªán c√≥. H√£y ch·ªù th√™m ch·ªØ m·ªõi!', 'hint');
                return;
            }
            
            availableWords.sort((a, b) => {
                if (a.type !== b.type) return a.type === 'main' ? -1 : 1;
                return a.word.length - b.word.length;
            });
            
            const selectedHint = availableWords[0];
            
            selectedHint.cells.forEach(cellIndex => {
                gridCells[cellIndex].element.classList.add('hint');
            });
            
            const hintDisplay = document.getElementById('hintDisplay');
            const wordType = selectedHint.type === 'main' ? 't·ª´ ch√≠nh' : 't·ª´ m·ªü r·ªông';
            hintDisplay.textContent = `üí° G·ª£i √Ω: T·ª´ "${selectedHint.word.toUpperCase()}" (${wordType}) ƒëang c√≥ tr√™n grid!`;
            hintDisplay.style.display = 'block';
            hintDisplay.className = 'hint-display';
            
            hintsRemaining--;
            document.getElementById('hintBtnSmall').innerHTML = `üí°<br><small>${hintsRemaining}</small>`;
            
            setTimeout(() => {
                clearAllHints();
            }, 5000);
        }

        function canFormWord(word, gridLetters) {
            const wordLetters = word.split('');
            const gridLetterCount = {};
            
            gridLetters.forEach(letter => {
                gridLetterCount[letter] = (gridLetterCount[letter] || 0) + 1;
            });
            
            const wordLetterCount = {};
            for (const letter of wordLetters) {
                wordLetterCount[letter] = (wordLetterCount[letter] || 0) + 1;
                
                if (!gridLetterCount[letter] || wordLetterCount[letter] > gridLetterCount[letter]) {
                    return false;
                }
            }
            
            return true;
        }

        function findWordCells(word) {
            const wordUpper = word.toUpperCase();
            const wordLetters = wordUpper.split('');
            const foundCells = [];
            const usedCellIndices = new Set();
            
            for (const letter of wordLetters) {
                let found = false;
                
                for (let i = 0; i < gridCells.length; i++) {
                    const cell = gridCells[i];
                    if (cell.hasLetter && 
                        cell.letter === letter && 
                        !usedCellIndices.has(i) &&
                        !foundCells.includes(i)) {
                        
                        foundCells.push(i);
                        usedCellIndices.add(i);
                        found = true;
                        break;
                    }
                }
                
                if (!found) {
                    return [];
                }
            }
            
            return foundCells;
        }

        function clearAllHints() {
            gridCells.forEach(cell => {
                cell.element.classList.remove('hint');
            });
            
            const hintDisplay = document.getElementById('hintDisplay');
            hintDisplay.style.display = 'none';
            hintDisplay.textContent = '';
        }

        function showHintMessage(message, type) {
            const hintDisplay = document.getElementById('hintDisplay');
            hintDisplay.textContent = message;
            hintDisplay.style.display = 'block';
            hintDisplay.className = `hint-display ${type}`;
            
            setTimeout(() => {
                hintDisplay.style.display = 'none';
                hintDisplay.textContent = '';
            }, 3000);
        }

        function checkWord() {
            if (selectedCells.length === 0) return;
            
            const currentWord = selectedCells.map(i => gridCells[i].letter).join('').toLowerCase();
            
            const matchingWord = targetWords.find(word => 
                word === currentWord && !completedWords.includes(word)
            );
            
            if (matchingWord) {
                correctWord(matchingWord, false);
                return;
            }
            
            const expansionMatch = expansionVocab.find(word => 
                word === currentWord && !bonusWords.includes(word)
            );
            
            if (expansionMatch) {
                correctWord(expansionMatch, true);
                return;
            }
            
            const allVocabMatch = allVocabWords.find(word => 
                word === currentWord && !completedWords.includes(word) && !bonusWords.includes(word)
            );
            
            if (allVocabMatch) {
                const isExpansionWord = expansionVocab.includes(allVocabMatch);
                correctWord(allVocabMatch, isExpansionWord);
                return;
            }
            
            wrongWord();
        }

        function correctWord(word, isBonus) {
            correctSound.play().catch(e => console.log('Audio play failed:', e));
            
            currentCombo++;
            let comboBonus = 0;
            if (currentCombo >= 2) {
                comboBonus = (currentCombo - 1) * 10;
                document.getElementById('comboDisplay').style.display = 'block';
                document.getElementById('combo').textContent = currentCombo;
                
                if (currentCombo >= 3) {
                    comboSound.play().catch(e => console.log('Audio play failed:', e));
                }
            }
            
            const baseScore = word.length * 10;
            const bonusMultiplier = isBonus ? 1.5 : 1;
            const totalScore = Math.floor((baseScore + comboBonus) * bonusMultiplier);
            currentScore += totalScore;
            document.getElementById('score').textContent = currentScore;
            
            if (isBonus) {
                if (!bonusWords.includes(word)) {
                    bonusWords.push(word);
                    document.getElementById('bonusCount').textContent = bonusWords.length;
                }
            } else {
                if (!completedWords.includes(word)) {
                    completedWords.push(word);
                    updateProgress();
                }
            }
            
            clearAllHints();
            
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.className = 'feedback correct';
            if (isBonus) {
                feedbackEl.textContent = `‚≠ê T·ª™ M·ªû R·ªòNG: ${word.toUpperCase()} (+${totalScore} ƒëi·ªÉm x1.5!)`;
            } else {
                feedbackEl.textContent = `‚úÖ ${word.toUpperCase()} (+${totalScore} ƒëi·ªÉm)`;
            }
            setTimeout(() => {
                feedbackEl.textContent = '';
                feedbackEl.className = 'feedback';
            }, 2000);
            
            selectedCells.forEach(index => {
                const cell = gridCells[index];
                cell.element.classList.add('correct');
                setTimeout(() => {
                    cell.element.classList.remove('correct', 'has-letter', 'selected');
                    cell.element.textContent = '';
                    cell.hasLetter = false;
                    cell.letter = '';
                }, 500);
            });
            
            selectedCells = [];
            updateCurrentWord();
            
            setTimeout(() => {
                if (!isGameOver) {
                    smartSpawn(true);
                }
            }, 600);
            
            if (completedWords.length % 3 === 0) {
                increaseSpeed();
            }
            
            const allTargetWordsCompleted = targetWords.every(word => 
                completedWords.includes(word)
            );
            
            if (allTargetWordsCompleted) {
                setTimeout(() => {
                    endGame(true, false);
                }, 1000);
            }
        }

        function wrongWord() {
            wrongSound.play().catch(e => console.log('Audio play failed:', e));
            
            currentCombo = 0;
            document.getElementById('comboDisplay').style.display = 'none';
            
            clearAllHints();
            
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.className = 'feedback wrong';
            feedbackEl.textContent = '‚ùå Sai r·ªìi! Th·ª≠ l·∫°i nh√©!';
            setTimeout(() => {
                feedbackEl.textContent = '';
                feedbackEl.className = 'feedback';
            }, 2000);
            
            clearSelection();
        }

        function clearSelection() {
            selectedCells.forEach(index => {
                gridCells[index].element.classList.remove('selected');
            });
            selectedCells = [];
            updateCurrentWord();
        }

        function togglePause() {
            isPaused = !isPaused;
            const pauseOverlay = document.getElementById('pauseOverlay');
            const practiceList = document.getElementById('practiceWordList');
            const highscoreMsg = document.getElementById('highscoreMessage');
            
            pauseOverlay.style.display = isPaused ? 'flex' : 'none';
            
            if (isPaused) {
                document.getElementById('pauseCombo').textContent = currentCombo;
                
                if (gameMode === 'practice') {
                    practiceList.style.display = 'block';
                    highscoreMsg.style.display = 'none';
                    
                    const wordListContainer = document.getElementById('pauseWordList');
                    wordListContainer.innerHTML = '';
                    
                    targetWords.forEach(word => {
                        const wordItem = document.createElement('div');
                        wordItem.className = completedWords.includes(word) ? 
                            'word-item completed' : 'word-item incomplete';
                        wordItem.textContent = word;
                        wordListContainer.appendChild(wordItem);
                    });
                } else {
                    practiceList.style.display = 'none';
                    highscoreMsg.style.display = 'block';
                }
            }
        }

        function increaseSpeed() {
            speedLevel++;
            document.getElementById('speedLevel').textContent = speedLevel;
            
            spawnDelay = Math.max(1500, spawnDelay - 1000);
            
            clearInterval(letterSpawnInterval);
            letterSpawnInterval = setInterval(() => {
                if (!isPaused && !isGameOver) {
                    spawnLetter();
                }
            }, spawnDelay);
            
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.className = 'feedback hint';
            feedbackEl.textContent = `üöÄ T·ªëc ƒë·ªô tƒÉng l√™n c·∫•p ${speedLevel}! (Spawn m·ªói ${spawnDelay/1000}s)`;
            setTimeout(() => {
                feedbackEl.textContent = '';
                feedbackEl.className = 'feedback';
            }, 2000);
        }

        function updateProgress() {
            const progress = (completedWords.length / targetWords.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressBar').textContent = Math.round(progress) + '%';
            document.getElementById('progressText').textContent = `${completedWords.length} / ${targetWords.length}`;
        }

        function endGame(completed, gridFull = false) {
            isGameOver = true;
            clearInterval(letterSpawnInterval);
            document.querySelector('.control-buttons-left').style.display = 'none';
            document.getElementById('checkBtnLarge').style.display = 'none';
            
            clearAllHints();
            
            const modal = document.getElementById('gameOverModal');
            const modalTitle = document.getElementById('modalTitle');
            const finalScore = document.getElementById('finalScore');
            const modeDisplay = document.getElementById('modeDisplay');
            const completionStats = document.getElementById('completionStats');
            const wordListSection = document.getElementById('wordListSection');
            const wordListItems = document.getElementById('wordListItems');
            const bonusWordsSection = document.getElementById('bonusWordsSection');
            const bonusWordsList = document.getElementById('bonusWordsList');
            
            if (gridFull) {
                modalTitle.textContent = 'üíÄ THUA R·ªíI! üíÄ';
                modalTitle.style.color = '#e74c3c';
                modalTitle.innerHTML = 'üíÄ THUA R·ªíI! üíÄ<br><small style="font-size: 16px;">Grid ƒë√£ ƒë·∫ßy, kh√¥ng c√≤n ch·ªó cho ch·ªØ m·ªõi</small>';
            } else if (completed) {
                modalTitle.textContent = 'üéâ Ch√∫c M·ª´ng! üéâ';
                modalTitle.style.color = '#27ae60';
            } else {
                modalTitle.textContent = 'üèÅ K·∫øt Th√∫c';
                modalTitle.style.color = '#3498db';
            }
            
            finalScore.innerHTML = `<strong>T·ªïng ƒêi·ªÉm:</strong> ${currentScore} üí∞`;
            
            if (gameMode === 'practice') {
                modeDisplay.innerHTML = `<strong>Ch·∫ø ƒê·ªô:</strong> Tr·∫£ B√†i<br><strong>Level:</strong> Super Minds ${selectedLevel} | <strong>Unit:</strong> ${selectedUnit}`;
            } else {
                modeDisplay.innerHTML = `<strong>Ch·∫ø ƒê·ªô:</strong> Thi ƒêua ƒêi·ªÉm Cao<br><strong>Level ƒê√£ H·ªçc:</strong> Super Minds ${selectedLevel}`;
            }
            
            completionStats.innerHTML = `<strong>Ho√†n Th√†nh:</strong> ${completedWords.length} / ${targetWords.length} t·ª´ (${Math.round((completedWords.length / targetWords.length) * 100)}%)`;
            
            if (bonusWords.length > 0) {
                bonusWordsSection.style.display = 'block';
                bonusWordsList.innerHTML = '';
                bonusWords.forEach(word => {
                    const wordItem = document.createElement('div');
                    wordItem.className = 'word-item bonus';
                    wordItem.textContent = word;
                    bonusWordsList.appendChild(wordItem);
                });
                
                const bonusMessage = document.createElement('div');
                bonusMessage.style.marginTop = '8px';
                bonusMessage.style.padding = '8px';
                bonusMessage.style.backgroundColor = '#fff9e6';
                bonusMessage.style.borderRadius = '6px';
                bonusMessage.style.fontSize = '13px';
                bonusMessage.innerHTML = `üéâ B·∫°n ƒë√£ t√¨m th·∫•y <strong>${bonusWords.length}</strong> t·ª´ m·ªü r·ªông!`;
                bonusWordsSection.appendChild(bonusMessage);
            } else {
                bonusWordsSection.style.display = 'none';
            }
            
            wordListSection.style.display = 'block';
            wordListItems.innerHTML = '';
            targetWords.forEach(word => {
                const wordItem = document.createElement('div');
                wordItem.className = completedWords.includes(word) ? 'word-item completed' : 'word-item incomplete';
                wordItem.textContent = word;
                wordListItems.appendChild(wordItem);
            });
            
            if (gameMode === 'highscore') {
                saveScore();
                showLeaderboard();
            } else {
                document.getElementById('leaderboardSection').style.display = 'none';
            }
            
            modal.style.display = 'flex';
        }

        function saveScore() {
            const leaderboard = JSON.parse(localStorage.getItem('letterGridLeaderboard') || '[]');
            
            const entry = {
                score: currentScore,
                level: selectedLevel,
                words: completedWords.length,
                bonus: bonusWords.length,
                date: new Date().toLocaleDateString('vi-VN')
            };
            
            leaderboard.push(entry);
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard.splice(5);
            
            localStorage.setItem('letterGridLeaderboard', JSON.stringify(leaderboard));
        }

        function showLeaderboard() {
            const leaderboard = JSON.parse(localStorage.getItem('letterGridLeaderboard') || '[]');
            const leaderboardSection = document.getElementById('leaderboardSection');
            const leaderboardList = document.getElementById('leaderboardList');
            
            if (leaderboard.length === 0) {
                leaderboardSection.style.display = 'none';
                return;
            }
            
            leaderboardSection.style.display = 'block';
            leaderboardList.innerHTML = '';
            
            leaderboard.forEach((entry, index) => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'leaderboard-entry';
                if (index === 0) entryDiv.classList.add('top1');
                else if (index === 1) entryDiv.classList.add('top2');
                else if (index === 2) entryDiv.classList.add('top3');
                
                const rank = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `#${index + 1}`;
                
                entryDiv.innerHTML = `
                    <div><strong>${rank}</strong> Level ${entry.level} - ${entry.words} t·ª´${entry.bonus ? ' (+' + entry.bonus + ' bonus)' : ''}</div>
                    <div><strong>${entry.score}</strong> ƒëi·ªÉm</div>
                `;
                leaderboardList.appendChild(entryDiv);
            });
        }

        function playAgain() {
            document.getElementById('gameOverModal').style.display = 'none';
            document.getElementById('gameSection').style.display = 'none';
            document.querySelector('.control-buttons-left').style.display = 'none';
            document.getElementById('checkBtnLarge').style.display = 'none';
            document.getElementById('mainTitle').style.display = 'block';
            document.getElementById('modeSection').style.display = 'block';
            document.getElementById('setupSection').style.display = 'none';
            
            document.getElementById('levelSelect').value = '';
            document.getElementById('unitSelect').value = '';
            document.getElementById('unitSelect').disabled = true;
            document.getElementById('startBtn').disabled = true;
            
            selectedLevel = '';
            selectedUnit = '';
        }

        function initializeMusic() {
            if (!musicInitialized) {
                const playMusic = () => {
                    backgroundMusic.play().then(() => {
                        isMusicPlaying = true;
                        document.getElementById('musicToggle').textContent = '‚ô´';
                        document.getElementById('musicToggle').classList.remove('muted');
                    }).catch(e => {
                        console.log('Auto-play prevented:', e);
                    });
                    musicInitialized = true;
                    document.removeEventListener('click', playMusic);
                    document.removeEventListener('keydown', playMusic);
                    document.removeEventListener('touchstart', playMusic);
                };
                
                document.addEventListener('click', playMusic);
                document.addEventListener('keydown', playMusic);
                document.addEventListener('touchstart', playMusic);
            }
        }

        function toggleMusic() {
            const musicBtn = document.getElementById('musicToggle');
            
            if (isMusicPlaying) {
                backgroundMusic.pause();
                musicBtn.textContent = '‚ô™';
                musicBtn.classList.add('muted');
                isMusicPlaying = false;
            } else {
                backgroundMusic.play().then(() => {
                    musicBtn.textContent = '‚ô´';
                    musicBtn.classList.remove('muted');
                    isMusicPlaying = true;
                }).catch(e => {
                    console.log('Play failed:', e);
                    alert('Please interact with the page to enable audio');
                });
            }
        }
    </script>
</body>
</html>
